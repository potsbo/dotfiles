#!/bin/bash

set -eux

brew_check() {
  if brew info $1 | grep "Not installed" > /dev/null 2>&1
  then
    echo "  + Installing $1..."
    brew install $1
  else
    echo "  + $1 found."
  fi
}

# Config
SRC_DIR=$HOME/src
DOTFILES_DIR=$HOME/.dotfiles
TMUX_DIR=$HOME/.tmux

# PATH
export GOPATH=$HOME/.go
export PATH=$PATH:$GOPATH/bin

# Install brew
if test ! $(which brew); then
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Check go
brew_check go
mkdir -p $GOPATH
mkdir -p $SRC_DIR
ln -s $HOME/src $GOPATH/src

# ghq
go get github.com/motemen/ghq

# dotfiles
ghq get potsbo/dotfiles
ln -s $SRC_DIR/potsbo/dotfiles $DOTFILES_DIR
CONFS=(.vimrc .zshrc .gitconfig, .gitignore_global .tmux.conf .tmux-powerlinerc)
for conf in ${CONFS[@]}; do
  if [ ! -f $HOME/$conf ]; then
    ln -s $HOME/.dotfiles/$conf $HOME/$conf
  fi
done

# tmux
brew_check tumx
ghq get potsbo/tmux-powerline
mkdir -p $HOME/.tmux
if [ ! -f $TMUX_DIR/tmux-powerline ]; then
  ln -s $SRC_DIR/potsbo/tmux-powerline $TMUX_DIR/tmux-powerline
fi

# rbenv
brew_check rbenv
